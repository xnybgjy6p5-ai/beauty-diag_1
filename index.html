<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美容力学 診断シート</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* カスタムスライダーのスタイル調整 */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid #6366f1;
            cursor: pointer;
            margin-top: -6px; /* トラックの中央に合わせる */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- アイコンコンポーネント (Lucide代替) ---
        const IconBase = ({ children, className = "", ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" height="24" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className} 
                {...props}
            >
                {children}
            </svg>
        );

        const Sparkles = (props) => (
            <IconBase {...props}>
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
            </IconBase>
        );

        const AlertTriangle = (props) => (
            <IconBase {...props}>
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
                <path d="M12 9v4" />
                <path d="M12 17h.01" />
            </IconBase>
        );

        const User = (props) => (
            <IconBase {...props}>
                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                <circle cx="12" cy="7" r="4" />
            </IconBase>
        );

        const Activity = (props) => (
            <IconBase {...props}>
                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
            </IconBase>
        );

        const Droplets = (props) => (
            <IconBase {...props}>
                <path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.75S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z" />
                <path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.58 3 2.5 3 5.5 3 7.4 0 2.76-2.24 5-5 5s-5-2.24-5-5c0-1.9 0-4.9 3-7.4.24-.2.52-.4.8-.62z" />
            </IconBase>
        );

        const CheckCircle2 = (props) => (
            <IconBase {...props}>
                <circle cx="12" cy="12" r="10" />
                <path d="m9 12 2 2 4-4" />
            </IconBase>
        );

        const MessageCircleQuestion = (props) => (
            <IconBase {...props}>
                <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z" />
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                <path d="M12 17h.01" />
            </IconBase>
        );

        const ClipboardList = (props) => (
            <IconBase {...props}>
                <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
                <path d="M12 11h4" />
                <path d="M12 16h4" />
                <path d="M8 11h.01" />
                <path d="M8 16h.01" />
            </IconBase>
        );

        const AlertCircle = (props) => (
            <IconBase {...props}>
                <circle cx="12" cy="12" r="10" />
                <line x1="12" x2="12" y1="8" y2="12" />
                <line x1="12" x2="12.01" y1="16" y2="16" />
            </IconBase>
        );

        const FileText = (props) => (
            <IconBase {...props}>
                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                <polyline points="14 2 14 8 20 8" />
                <path d="M16 13H8" />
                <path d="M16 17H8" />
                <path d="M10 9H8" />
            </IconBase>
        );

        const Download = (props) => (
            <IconBase {...props}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="7 10 12 15 17 10" />
                <line x1="12" x2="12" y1="15" y2="3" />
            </IconBase>
        );


        // --- メインアプリ ---
        function App() {
            // 1. 基本属性
            const [userName, setUserName] = useState('');
            const [gender, setGender] = useState('');
            const [age, setAge] = useState('');

            // 2. 肌質・ケア習慣 (複数選択可)
            const [skinTypes, setSkinTypes] = useState([]);
            const [careItems, setCareItems] = useState([]);
            const [washHabits, setWashHabits] = useState([]);

            // 3. 力学インジケーター (0-10)
            const [sliders, setSliders] = useState({
                sting: 0, // ピリピリ
                loss: 0,  // つっぱり
                red: 0,   // 赤み
                itch: 0   // 痒み
            });

            // 4. 悩み・商品データ
            const [troubles, setTroubles] = useState('');
            const [productData, setProductData] = useState('');

            // 警告フラグ
            const [isCritical, setIsCritical] = useState(false);

            // 選択肢データ
            const skinTypeOptions = ['普通', '乾燥', '脂性', '混合', 'アトピー', '敏感/過敏'];
            const careItemOptions = ['導入液', '化粧水', '美容液', '乳液', 'クリーム', 'オールインワン', 'オイル', 'UV', 'シートマスク(毎日)'];
            const washHabitOptions = ['石けん洗顔', '洗顔フォーム', 'クレンジング', '拭き取り'];

            // リアルタイム監視: いずれかが7を超えたら警告
            useEffect(() => {
                const maxVal = Math.max(sliders.sting, sliders.loss, sliders.red, sliders.itch);
                setIsCritical(maxVal > 7);
            }, [sliders]);

            // 配列のトグル処理
            const toggleSelection = (setter, list, item) => {
                if (list.includes(item)) {
                setter(list.filter(i => i !== item));
                } else {
                setter([...list, item]);
                }
            };

            // スライダーの更新
            const handleSliderChange = (e, key) => {
                setSliders({ ...sliders, [key]: parseInt(e.target.value) });
            };

            // TXTファイル生成とダウンロード
            const generateAndDownloadTxt = () => {
                const txtContent = `【美容力学診断用データ】
ユーザー名: ${userName || '未入力'} / 年齢: ${age || '未入力'} / 性別: ${gender || '未入力'}

■ 力学ステータス(0-10)
Λ_sting(ピリピリ): ${sliders.sting} ${sliders.sting > 7 ? '(🚨 警告: 高)' : ''}
Σ_loss(つっぱり): ${sliders.loss} ${sliders.loss > 7 ? '(🚨 警告: 高)' : ''}
Λ_red(赤み): ${sliders.red} ${sliders.red > 7 ? '(🚨 警告: 高)' : ''}
Λ_itch(痒み): ${sliders.itch} ${sliders.itch > 7 ? '(🚨 警告: 高)' : ''}

■ 現在の肌質
${skinTypes.length > 0 ? skinTypes.join(', ') : '未選択'}

■ ケア習慣
使用カテゴリ: ${careItems.length > 0 ? careItems.join(', ') : '未選択'}
洗浄習慣: ${washHabits.length > 0 ? washHabits.join(', ') : '未選択'}
悩み: ${troubles || '特になし'}

■ 使用製品詳細(CSV形式等)
${productData || 'データなし'}

---

■【AI解析用プロンプト】

1. 演算フェーズ（内部思考）:
提示された「力学ステータス」と「使用製品の成分データ」に基づき、美容力学公式を用いて現在の肌の物理構造を分析せよ。特に以下の変数を厳密に算出すること。
- Σ(バリア強度)の毀損率
- Λ(累積ダメージ)の臨界突破状況（特にΛ_stingが7を超えている場合）
- Δ(成分ポテンシャル)が現在のΣに対して過剰（オーバーフロー）ではないか

2. 出力フェーズ（ナラティブ変換）:
演算結果を以下の「絶対ルール」に従ってユーザーへ伝えよ。

[絶対ルール]
- 物理的用語の禁止: 「Σ」「Λ」「界面活性剤」「ポテンシャル」等の専門用語は一切出さない。
- 柔らかい動詞への置換: 
  ×「バリア機能が低下」→ ○「肌の守りが薄くなって、隙間ができている」
  ×「成分が浸透」→ ○「成分が肌の奥まで入り込みすぎている」
  ×「Λの累積」→ ○「日々の負担が溜まっている」
- 語彙の卑近化: 中学生でもわかる言葉を選び、熟語の連発を避ける（固い印象を与えない）。
- 介入策の提示: 臨界突破（7以上）時は、優しく、しかし断固として「今すぐやめるべきこと」と「守るための具体的な動き」を最優先で伝えること。

3. キャラクター設定:
丁寧だが気さくで親しみやすい、馴染みのコスメ店員（男性）のようなトーンで、相手に寄り添いつつ的確に導くこと。
`;

                const blob = new Blob([txtContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `美容診断_${userName || 'guest'}_${new Date().getTime()}.txt`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };

            return (
                <div className="min-h-screen font-sans py-8 px-4 sm:px-6">
                <div className="max-w-4xl mx-auto">
                    {/* ヘッダー */}
                    <header className="text-center mb-10">
                    <div className="inline-flex items-center justify-center p-3 bg-indigo-600 rounded-2xl shadow-lg mb-4">
                        <Sparkles className="w-8 h-8 text-white" />
                    </div>
                    <h1 className="text-3xl sm:text-4xl font-bold text-slate-800 tracking-tight">
                        美容力学 診断シート
                    </h1>
                    <p className="mt-2 text-slate-500">
                        肌の物理的状態（力学ステータス）を可視化し、最適なケアを導き出します
                    </p>
                    </header>

                    {/* 警告表示エリア */}
                    {isCritical && (
                    <div className="mb-8 transform transition-all duration-500 ease-out animate-in slide-in-from-top-4">
                        <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg shadow-sm flex items-start gap-3">
                        <AlertTriangle className="w-6 h-6 text-red-500 flex-shrink-0 mt-0.5" />
                        <div>
                            <h3 className="font-bold text-red-700">警告：バリア臨界突破の可能性</h3>
                            <p className="text-red-600 text-sm mt-1">
                            力学インジケーターが危険域（7以上）に達しています。早急なケアの見直しが必要です。
                            </p>
                        </div>
                        </div>
                    </div>
                    )}

                    <div className="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100">
                    
                    {/* 1. 基本属性 */}
                    <section className="p-6 sm:p-8 border-b border-slate-100">
                        <div className="flex items-center gap-2 mb-6">
                        <User className="w-5 h-5 text-indigo-600" />
                        <h2 className="text-xl font-bold text-slate-800">1. 基本属性</h2>
                        </div>
                        
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="space-y-2">
                            <label className="text-sm font-medium text-slate-700">ユーザー名</label>
                            <input 
                            type="text" 
                            className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all"
                            value={userName} 
                            onChange={e => setUserName(e.target.value)} 
                            placeholder="例: Yamada" 
                            />
                        </div>
                        <div className="space-y-2">
                            <label className="text-sm font-medium text-slate-700">性別</label>
                            <select 
                            className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all bg-white"
                            value={gender} 
                            onChange={e => setGender(e.target.value)}
                            >
                            <option value="">選択してください</option>
                            <option value="女性">女性</option>
                            <option value="男性">男性</option>
                            <option value="その他">その他</option>
                            </select>
                        </div>
                        <div className="space-y-2">
                            <label className="text-sm font-medium text-slate-700">年齢</label>
                            <input 
                            type="text" 
                            className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all"
                            value={age} 
                            onChange={e => setAge(e.target.value)} 
                            placeholder="例: 30代" 
                            />
                        </div>
                        </div>
                    </section>

                    {/* 2. 力学インジケーター */}
                    <section className="p-6 sm:p-8 border-b border-slate-100 bg-slate-50/50">
                        <div className="flex items-center gap-2 mb-2">
                        <Activity className="w-5 h-5 text-indigo-600" />
                        <h2 className="text-xl font-bold text-slate-800">2. 力学インジケーター (0-10)</h2>
                        </div>
                        <p className="text-sm text-slate-500 mb-6 ml-7">現在の肌の感覚を直感的に入力してください。</p>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12">
                        {[
                            { key: 'sting', label: '⚡ ピリピリ (Λ_sting)', color: 'text-yellow-600' },
                            { key: 'loss', label: '🌵 つっぱり (Σ_loss)', color: 'text-green-600' },
                            { key: 'red', label: '🍎 赤み (Λ_red)', color: 'text-red-600' },
                            { key: 'itch', label: '🐜 痒み (Λ_itch)', color: 'text-pink-600' }
                        ].map(item => {
                            const value = sliders[item.key];
                            const isHigh = value > 7;
                        
                            return (
                            <div key={item.key} className="relative group">
                                <div className="flex justify-between items-end mb-2">
                                <span className={`font-medium ${item.color} flex items-center gap-1`}>
                                    {item.label}
                                </span>
                                <span className={`text-2xl font-bold transition-colors ${isHigh ? 'text-red-600' : 'text-slate-700'}`}>
                                    {value}
                                </span>
                                </div>
                                
                                <div className="relative h-2 w-full bg-slate-200 rounded-full">
                                <div 
                                    className={`absolute top-0 left-0 h-full rounded-full transition-all duration-300 ${isHigh ? 'bg-red-500' : 'bg-indigo-500'}`}
                                    style={{ width: `${value * 10}%` }}
                                ></div>
                                <input 
                                    type="range" 
                                    min="0" max="10" 
                                    value={value} 
                                    onChange={(e) => handleSliderChange(e, item.key)}
                                    className="absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer z-10"
                                />
                                <div 
                                    className="absolute top-1/2 -mt-2 w-4 h-4 bg-white border-2 border-indigo-500 rounded-full shadow pointer-events-none transition-all duration-100"
                                    style={{ left: `calc(${value * 10}% - 8px)` }}
                                ></div>
                                </div>
                                
                                <div className="flex justify-between text-xs text-slate-400 mt-2 font-medium">
                                <span>なし (0)</span>
                                <span>最大 (10)</span>
                                </div>
                            </div>
                            );
                        })}
                        </div>
                    </section>

                    {/* 3. 肌質・ケア習慣 */}
                    <section className="p-6 sm:p-8 border-b border-slate-100">
                        <div className="flex items-center gap-2 mb-6">
                        <Droplets className="w-5 h-5 text-indigo-600" />
                        <h2 className="text-xl font-bold text-slate-800">3. 肌質・ケア習慣</h2>
                        </div>
                        
                        <div className="space-y-6">
                        <div>
                            <div className="flex items-center gap-2 mb-3">
                            <span className="text-sm font-semibold text-slate-700 px-2 py-1 bg-slate-100 rounded">肌質</span>
                            <span className="text-xs text-slate-500">複数選択可</span>
                            </div>
                            <div className="flex flex-wrap gap-2">
                            {skinTypeOptions.map(option => {
                                const isSelected = skinTypes.includes(option);
                                return (
                                <button 
                                    key={option} 
                                    onClick={() => toggleSelection(setSkinTypes, skinTypes, option)}
                                    className={`px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 flex items-center gap-1.5
                                    ${isSelected 
                                        ? 'bg-blue-500 text-white shadow-md shadow-blue-200 ring-2 ring-blue-200' 
                                        : 'bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300'
                                    }`}
                                >
                                    {isSelected && <CheckCircle2 className="w-3.5 h-3.5" />}
                                    {option}
                                </button>
                                );
                            })}
                            </div>
                        </div>

                        <div>
                            <div className="flex items-center gap-2 mb-3">
                            <span className="text-sm font-semibold text-slate-700 px-2 py-1 bg-slate-100 rounded">現在のケア</span>
                            <span className="text-xs text-slate-500">複数選択可</span>
                            </div>
                            <div className="flex flex-wrap gap-2">
                            {careItemOptions.map(option => {
                                const isSelected = careItems.includes(option);
                                return (
                                <button 
                                    key={option} 
                                    onClick={() => toggleSelection(setCareItems, careItems, option)}
                                    className={`px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 flex items-center gap-1.5
                                    ${isSelected 
                                        ? 'bg-emerald-500 text-white shadow-md shadow-emerald-200 ring-2 ring-emerald-200' 
                                        : 'bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300'
                                    }`}
                                >
                                    {isSelected && <CheckCircle2 className="w-3.5 h-3.5" />}
                                    {option}
                                </button>
                                );
                            })}
                            </div>
                        </div>

                        <div>
                            <div className="flex items-center gap-2 mb-3">
                            <span className="text-sm font-semibold text-slate-700 px-2 py-1 bg-slate-100 rounded">洗浄習慣</span>
                            <span className="text-xs text-slate-500">複数選択可</span>
                            </div>
                            <div className="flex flex-wrap gap-2">
                            {washHabitOptions.map(option => {
                                const isSelected = washHabits.includes(option);
                                return (
                                <button 
                                    key={option} 
                                    onClick={() => toggleSelection(setWashHabits, washHabits, option)}
                                    className={`px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 flex items-center gap-1.5
                                    ${isSelected 
                                        ? 'bg-violet-500 text-white shadow-md shadow-violet-200 ring-2 ring-violet-200' 
                                        : 'bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300'
                                    }`}
                                >
                                    {isSelected && <CheckCircle2 className="w-3.5 h-3.5" />}
                                    {option}
                                </button>
                                );
                            })}
                            </div>
                        </div>
                        </div>
                    </section>

                    {/* 4. 悩み・質問 */}
                    <section className="p-6 sm:p-8 border-b border-slate-100">
                        <div className="flex items-center gap-2 mb-4">
                        <MessageCircleQuestion className="w-5 h-5 text-indigo-600" />
                        <h2 className="text-xl font-bold text-slate-800">4. 悩み・質問</h2>
                        </div>
                        <textarea 
                        className="w-full border border-slate-200 rounded-xl p-4 min-h-[120px] focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder:text-slate-400" 
                        placeholder="例: 最近レチノールを始めてから乾燥がひどく、化粧水がしみるようになりました。"
                        value={troubles}
                        onChange={e => setTroubles(e.target.value)}
                        ></textarea>
                    </section>

                    {/* 5. 商品データ */}
                    <section className="p-6 sm:p-8 bg-slate-50/50">
                        <div className="flex items-center gap-2 mb-2">
                        <ClipboardList className="w-5 h-5 text-indigo-600" />
                        <h2 className="text-xl font-bold text-slate-800">5. 商品データ (ペーストエリア)</h2>
                        </div>
                        <div className="flex items-start gap-2 mb-4 text-sm text-slate-500 bg-white p-3 rounded-lg border border-slate-200">
                        <AlertCircle className="w-4 h-4 text-indigo-500 mt-0.5 flex-shrink-0" />
                        <span>前段のシステムで出力された成分・製品情報をそのまま貼り付けてください。</span>
                        </div>
                        <textarea 
                        className="w-full border border-slate-200 rounded-xl p-4 min-h-[150px] font-mono text-sm bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder:text-slate-400" 
                        placeholder="製品名,カテゴリ,主な成分,URL&#10;..."
                        value={productData}
                        onChange={e => setProductData(e.target.value)}
                        ></textarea>
                    </section>

                    {/* 出力ボタン */}
                    <div className="p-8 text-center bg-white">
                        <button 
                        onClick={generateAndDownloadTxt}
                        className="group relative inline-flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-12 rounded-full shadow-xl shadow-indigo-200 transform transition-all duration-200 hover:scale-[1.02] active:scale-[0.98]"
                        >
                        <FileText className="w-5 h-5" />
                        <span>診断用データを生成する</span>
                        <Download className="w-4 h-4 opacity-70 group-hover:opacity-100 transition-opacity" />
                        </button>
                        <p className="text-xs text-slate-400 mt-4">
                        ※クリックするとAI用のプロンプトが付与されたテキストファイル(.txt)がダウンロードされます
                        </p>
                    </div>

                    </div>
                    
                    <footer className="mt-12 text-center text-slate-400 text-sm">
                    &copy; {new Date().getFullYear()} Beauty Diagnostics. All rights reserved.
                    </footer>
                </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>